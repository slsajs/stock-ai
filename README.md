# KIS API 주식 자동매매 시스템

한국투자증권 KIS API를 활용한 실시간 주식 자동매매 시스템입니다.

## 주요 기능

### 📈 실시간 데이터 처리
- WebSocket을 통한 실시간 현재가, 호가, 체결 데이터 수신
- 1분봉 데이터 자동 저장 및 차트 생성
- 거래량 급증 감지 (평소 대비 3배 이상)

### 🤖 자동 매매 로직
- **진입 조건**: RSI 30 이하 매수 신호 + 거래량 급증
- **청산 조건**: RSI 70 이상 매도 신호 또는 손절/익절
- **리스크 관리**: 손절 -3%, 익절 +5%
- **포지션 관리**: 최대 동시 보유 종목 3개

### 🔧 기술적 특징
- Python asyncio 기반 비동기 처리
- 에러 발생 시 텔레그램 자동 알림
- 매매 내역 CSV 자동 저장
- 모듈화된 코드 구조

## 설치 및 설정

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. 환경 변수 설정
`.env.example`을 참고하여 `.env` 파일을 생성하고 API 키를 설정하세요.

```bash
cp .env.example .env
```

필수 설정 항목:
- `KIS_APP_KEY`: 한국투자증권 API 키
- `KIS_APP_SECRET`: 한국투자증권 API 시크릿
- `KIS_ACCOUNT_NO`: 계좌번호 (형식: XXXXXXXX-XX)

선택 설정 항목:
- `TELEGRAM_BOT_TOKEN`: 텔레그램 봇 토큰
- `TELEGRAM_CHAT_ID`: 텔레그램 채팅 ID

### 3. 설정 파일 커스터마이징
`config.json` 파일에서 매매 설정을 조정할 수 있습니다:

- **거래 설정**: 손절/익절 비율, RSI 임계값
- **대상 종목**: 자동매매 대상 종목 리스트
- **거래 시간**: 매매 활성 시간대
- **로깅**: 로그 레벨 및 파일 설정

## 사용 방법

### API 연결 테스트
```bash
python main.py test
```

### 자동매매 실행
```bash
python main.py
```

### 주요 명령어
- `Ctrl+C`: 시스템 안전 종료
- 로그 파일: `trading.log`에서 실시간 상황 확인
- 거래 기록: `trades.csv`에서 매매 내역 확인

## 프로젝트 구조

```
stock-test/
├── main.py              # 메인 실행 파일
├── api_client.py        # KIS API 클라이언트
├── trader.py            # 자동매매 로직
├── utils.py             # 유틸리티 함수들
├── config.json          # 설정 파일
├── requirements.txt     # 의존성 목록
├── .env.example         # 환경변수 템플릿
├── README.md           # 문서
├── trading.log         # 실행 로그 (자동 생성)
└── trades.csv          # 거래 기록 (자동 생성)
```

## 안전 장치

### 리스크 관리
- **손절**: 매수가 대비 -3% 도달시 자동 매도
- **익절**: 매수가 대비 +5% 도달시 자동 매도
- **포지션 제한**: 최대 3개 종목까지만 동시 보유
- **거래 시간**: 장중(09:00-15:30)에만 매매 활성화

### API 제한 준수
- 초당 20회 API 호출 제한 준수
- 자동 재연결 및 에러 복구
- 로그를 통한 상세한 실행 기록

### 모의투자 환경
- 기본적으로 모의투자 환경에서 실행
- 실제 자금 손실 없이 안전한 테스트 가능

## 모니터링

### 실시간 모니터링
- 콘솔 로그를 통한 실시간 상황 확인
- `trading.log` 파일의 상세 로그
- 텔레그램을 통한 주요 이벤트 알림

### 거래 기록 분석
- `trades.csv`: 모든 매매 기록 저장
- 일일 손익 통계 자동 계산
- 승률, 평균 수익률 등 성과 지표

## 주의사항

⚠️ **중요**: 이 시스템은 교육 및 연구 목적으로 제작되었습니다.
- 투자에는 항상 손실 위험이 따릅니다
- 충분한 테스트 후 소액으로 시작하세요
- 시장 상황에 따라 전략을 조정하세요

## 라이센스

이 프로젝트는 MIT 라이센스 하에 배포됩니다.

## 지원 및 문의

프로젝트 관련 문의사항이나 버그 리포트는 GitHub Issues를 통해 제보해 주세요.